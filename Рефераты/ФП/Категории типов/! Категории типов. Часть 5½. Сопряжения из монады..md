
В этот раз мы проанализируем различные способы факторизации монады на сопряжённые функторы, а именно, рассмотрим два противоположных варианта, раскрывающих наиболее важные аспекты факторизации. Это даст нам более глубокое понимание самого понятия монады и послужит мотивацией для построения операции факторизации произвольного функтора.

Изначально планировал начать с этой темы шестую часть обзора, посвящённую расширениям Кана, но формально она имеет большее отношение к теме предыдущей публикации, сопряжённым функторам. В итоге материала набралось достаточно на самостоятельную публикацию с промежуточным номером)).

![[Pasted image 20260201113101.png|Нумерация в стиле Френка Дребина.]]

# Забывающе-свободные сопряжения

Функциональные отношения могут быть инъективными — *разным* объектам из области определения инъективной функции ставятся в соответствие *разные* объекты в её образе. В этом случае информация не теряется, и по любому объекту из образа всегда можно восстановить исходный объект. Однако, очень часто функция оказывается не инъективной и её образ оказывается меньше области определения, когда некоторые разные исходные объекты приводят в один и тот же. Такая функция *забывает* часть исходной информации, она оказывается *необратимой*.

Функторы — это по сути те же функции, преобразующие морфизмы одной категории в морфизмы другой. И также как и функции, функторы имеют «забывающую природу». Сопряжённые же функторы, действуют навстречу другу другу, и когда один из них теряет особенности исходной категории, другой, наоборот, старается восстановить как можно больше потерянной информации.

![[! Диаграммы для 6 части#Сопряжение LR]]
Рассмотрим сопряжение $L \dashv R$ функторов $R: \mathcal{C} \rightarrow \mathcal{D}$ и $L: \mathcal{D} \rightarrow \mathcal{C}$. Такие обозначения выбраны не случайно — функтор $L$ (*left*) сопряжён *слева* и на диаграмме действует «влево», тогда как $R$ (*right*) сопряжён справа и действует «вправо». Каждый из них пытается «восстановить» информацию, теряемую другим функтором, но делают они это по-разному.

Пусть функтор $R$ для объектов $c,\, c': \mathcal{C}$ (для их тождественных морфизмов) даёт один и тот же $Rc=Rc'=d:\; \mathcal{D}$. Очевидно, что функтор $L$ не сможет из этого объекта восстановить одновременно $c$ и $c'$. Но вместо этого он может вернуть «более общий» объект $L\,d:\;\mathcal{C}$, из которого исходные объекты можно восстановить посредством коединицы сопряжения $\varepsilon:\; L \circ R \rightsquigarrow Id$, компоненты которой индексированы $c$ и $c'$.

![[! Диаграммы для 6 части#Восстановление забытого LR]]


С другой стороны, единица сопряжения $\eta:\; Id \rightsquigarrow R \circ L$ «стягивает» два объекта $a,\,b: \mathcal{D}$ в один $RLd=RLd': \mathcal{D}$. Из образа функтора $R$ не получится перейти к исходным объектам. И всё же, объекты образа будут «наиболее общими» в таком же смысле, что и, например, произведение типов среди всех кандидатов. 

![[! Диаграммы для 6 части#Восстановление забытого RL]]

### !!! про своеобразность обратности правого сопряжения


Часто выделяют особый класс *забывающих функторов*, объединённых одной идеей. Пусть левая категория $\mathcal{C}$ состоит из тех же объектов, что и $\mathcal{D}$, но морфизмов в ней меньше — hom-объекты в $\mathcal{C}$ ограничены дополнительными условиями. Типичный пример: справа у нас категория множеств $\mathrm{Set}$ со всеми возможными функциями, а слева — категория моноидов над множествами $\mathrm{Mon}(\mathrm{Set})$. Объекты $m$ в ней являются такой конструкцией $(a \in \mathrm{Set},\,mon:\; a \otimes a + 1 \rightarrow a,\, \text{законы моноида})$. Допустимы лишь те морфизмы, что переводят одни моноиды в другие, то есть коммутируют с $mon$, сохраняя законы ассоциативности композиции и нейтрального элементы. Нас тут интересует функтор $U:\; \mathrm{Mon(Set)} \rightarrow \mathrm{Set}$, сопоставляющий каждому моноиду его множество.

![[! Диаграммы для 6 части#Забывание моноида]]
В категории $\mathrm{Set}$ между любыми объектами полно морфизмов, которых нет в $\mathrm{Mon(Set)}$. Функтор $U$ **забывает ограничения** $\mathrm{Mon(Set)}$ — «особенные» морфизмы сохраняющие моноиды буквально теряются в $\mathrm{Set}$ среди прочих морфизмов. Функторы, отображающие hom-множества *не сюръективно*, называют «забывающим».

За восстановление потерянных данных отвечает функтор $F$, сопряжённый к $U$ слева: $F \vdash U$.
![[! Диаграммы для 6 части#Изоморфизм hom-объектов для сопряжения $F \vdash U$]]
Для любого множества $a$ функтор $F$ подбирает такой моноид $Fa$, чтобы каждому морфизму моноидов $Fa \rightarrow m$ взаимно однозначно соответствовал морфизм множеств $a \rightarrow Um$. Очевидно, что $UFa \neq a$, то есть функтор $F$ приводит к моноиду, у которого *основное множество* будет отличаться от исходного. Объект $Fa$ представляет собой *наиболее общий моноид* для множества $a$, такой, что для него существует столько же способов получить произвольный моноид $m$, сколько и обычных функций от $a$ к множеству $m$. Бинарная операция для $Fa$ должна быть максимально обобщённой, *свободной* от привязки к другим бинарным операциям и позволяющей получить любую из них. Такой объект называется *свободным моноидом* для множества $a$. Функторы, сопряженные к забывающим слева, называют **свободными функторами**.

![[Вспомнить всё.png|Примерно так свободный функтор пытается восстановить всё то, что растерял забывающий.|600]]

Наверняка вы уже знаете, что свободным моноидом над множеством является *список* его элементов. Проверить это не сложно, но гораздо важнее научится *конструктивно выводить* подобные знания из условий задачи. Это мы сделаем позже, когда у нас будет алгоритм вычисления сопряжений. Сейчас же давайте сконцентрируемся на «обратности» сопряженных функторов по отношению к исходному.






# Сопряжение Клейсли

Категория Клейсли $\mathcal{C}_F$ для монады $F: \mathcal{C} \to \mathcal{C}$ с объектами из $\mathcal{C}$ и морфизмами $\mathrm{Hom}_{\mathcal{C}}(a, b)=a \to F b$.

Фактически существует целая категория сопряжений $\mathcal{Adj}(\mathcal{C}, F)$, которые приводят к одной и той же монаде $F$ на $\mathcal{C}$. Сопряжением Клейсли, которое мы только что рассмотрели, является инициальный объект в этой категории, а сопряжением Эйленберга-Мура является терминальный объект.


Пусть $(\mathcal{C}_{Init},F_{cl},G_{cl})$ — начальный объект. Для любого $(\mathcal{D},F,G)$ существует единственный функтор $L:\mathcal{C}_{Init}\rightarrow \mathcal{D}$ такой, что:
- $L\circ F_{cl}=F$
- $G\circ L=G_{cl}$

## Шаг 1: Определение объектов
Чтобы $L$ мог быть определен для любого сопряжения, включая те, где $\mathcal{D}$ минимальна, объекты $\mathcal{C}_{Init}$ должны порождаться объектами $\mathcal{C}$ через функтор $F_{cl}$. Положим $Ob(\mathcal{C}_{Init})=Ob(\mathcal{C})$, где объект $X$ соответствует образу $F_{cl}(X)$.
## Шаг 2: Вывод морфизмов
Рассмотрим морфизмы в $\mathcal{C}_{Init}$ между $X$ и $Y$. Функтор $L$ должен переводить их в морфизмы $\mathcal{D}$ между $L(F_{cl}X)$ и $L(F_{cl}Y)$. Согласно условию $LF_{cl}=F$:
$$
\text{Hom}_{\mathcal{C}_{Init}}(X,Y)\xrightarrow{L}\text{Hom}_{\mathcal{D}}(FX,FY)
$$

По свойству сопряжения $F \dashv G$:
$$
\text{Hom}_{\mathcal{D}}(FX,FY)\cong \text{Hom}_{\mathcal{C}}(X,GFY)=\text{Hom}_{\mathcal{C}}(X,TY)
$$

Чтобы функтор $L$ был единственным и существовал для любого сопряжения, пространство морфизмов $\text{Hom}_{\mathcal{C}_{Init}}(X,Y)$ обязано быть изоморфно $\text{Hom}_{\mathcal{C}}(X,TY)$.
## Шаг 3: Определение композиции
Пусть $f\in \text{Hom}(X,TY)$ и $g\in \text{Hom}(Y,TZ)$. Чтобы $L$ был функтором, образ композиции в $\mathcal{D}$ должен совпадать с композицией образов. Это требование через изоморфизм сопряжения однозначно индуцирует закон композиции Клейсли:
$$
g\diamond f=\mu _{Z}\circ Tg\circ f
$$

## Шаг 4: Определение функторов начального объекта
- $F_{cl}(X)=X$ на объектах. Для $f:X\rightarrow Y$ в $\mathcal{C}$, $F_{cl}(f)=\eta _{Y}\circ f$ (единственный морфизм в $TY$, сохраняющий структуру).
- $G_{cl}(X)=G(LX)=G(FX)=TX$.

Это в точности конструкция категории Клейсли $\mathcal{C}_{T}$.

## Итог
Начальный объект выводится через **анализ пространств морфизмов**, необходимых для существования универсального отображения (приводит к Клейсли).

# Сопряжение Эйленберга-Мура


Пусть $(\mathcal{C}_{Term},F_{T},G_{T})$ — терминальный объект. По определению, для любого сопряжения $(\mathcal{D},F,G)$, порождающего $\mathbb{T}$, существует единственный функтор $K:\mathcal{D}\rightarrow \mathcal{C}_{Term}$ такой, что:
- $G_{T}\circ K=G$
- $K\circ F=F_{T}$

## Шаг 1: Определение носителя
Для любого объекта $d\in \mathcal{D}$ объект $K(d)$ должен быть определен так, чтобы удовлетворять $G_{T}(K(d))=G(d)$. Это означает, что объект в терминальной категории — это объект $G(d)$ из $\mathcal{C}$, наделенный некоторой дополнительной структурой, которую $G_{T}$ отбрасывает.
## Шаг 2: Вывод структуры объекта
В любом сопряжении $F \dashv G$ существует коединица $\varepsilon :FG\rightarrow \text{Id}_{\mathcal{D}}$. Применим к ней функтор $G$:
$$
G(\varepsilon _{d}):GFG(d)\rightarrow G(d)
$$
Так как $GF=T$, мы получаем морфизм $h_{d}:T(Gd)\rightarrow Gd$ в категории $\mathcal{C}$.Согласно треугольным тождествам сопряжения, пара $(G(d),h_{d})$ удовлетворяет двум уравнениям:
- $h_{d}\circ \eta _{Gd}=\text{Id}_{Gd}$
- $h_{d}\circ \mu _{Gd}=h_{d}\circ T(h_{d})$
Следовательно, отображение $K$ сопоставляет объекту $d$ структуру алгебры Эйленберга-Мура. Чтобы $K$ был единственным для любого $\mathcal{D}$, объекты $\mathcal{C}_{Term}$ должны быть всеми такими парами $(A,h)$, а морфизмы — морфизмами алгебр.
## Шаг 3: Определение функторов терминального объекта
- Из условия $G_{T}(K(d))=G(d)$ следует, что $G_{T}(A,h)=A$.
- Из условия $K(F(X))=F_{T}(X)$ и того, что $K(d)=(Gd,G\varepsilon _{d})$, следует:$F_{T}(X)=(GFX,G\varepsilon _{FX})=(TX,\mu _{X})$.
Это в точности конструкция категории алгебр $\mathcal{C}^{T}$. 

## Итог
Терминальный объект выводится через **анализ структуры носителя** произвольного сопряжения (приводит к алгебрам).

![[! Категории типов. Часть 5½. Алгебры  Эйленберга-Мура]]

# Промежуточный итог