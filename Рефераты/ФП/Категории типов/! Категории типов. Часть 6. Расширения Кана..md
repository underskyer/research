
# Забывающе-свободные сопряжения

Функциональные отношения могут быть инъективными — *разным* объектам из области определения инъективной функции ставятся в соответствие *разные* объекты в её образе. В этом случае информация не теряется, и по любому объекту из образа всегда можно восстановить исходный объект. Однако, очень часто функция оказывается не инъективной и её образ оказывается меньше области определения, когда некоторые разные исходные объекты приводят в один и тот же. Такая функция *забывает* часть исходной информации, она оказывается *необратимой*.

Функторы — это по сути те же функции, преобразующие морфизмы одной категории в морфизмы другой. И также как и функции, функторы имеют «забывающую природу». Сопряжённые же функторы, действуют навстречу другу другу, и когда один из них теряет особенности исходной категории, другой, наоборот, старается восстановить как можно больше потерянной информации.

![[! Диаграммы для 6 части#Сопряжение LR]]
Рассмотрим сопряжение $L \dashv R$ функторов $R: \mathcal{C} \rightarrow \mathcal{D}$ и $L: \mathcal{D} \rightarrow \mathcal{C}$. Такие обозначения выбраны не случайно — функтор $L$ (*left*) сопряжён *слева* и на диаграмме действует «влево», тогда как $R$ (*right*) сопряжён справа и действует «вправо». Каждый из них пытается «восстановить» информацию, теряемую другим функтором, но делают они это по-разному.

Пусть функтор $R$ для объектов $c,\, c': \mathcal{C}$ (для их тождественных морфизмов) даёт один и тот же $Rc=Rc'=d:\; \mathcal{D}$. Очевидно, что функтор $L$ не сможет из этого объекта восстановить одновременно $c$ и $c'$. Но вместо этого он может вернуть «более общий» объект $L\,d:\;\mathcal{C}$, из которого исходные объекты можно восстановить посредством коединицы сопряжения $\varepsilon:\; L \circ R \rightsquigarrow Id$, компоненты которой индексированы $c$ и $c'$.

![[! Диаграммы для 6 части#Восстановление забытого LR]]


С другой стороны, единица сопряжения $\eta:\; Id \rightsquigarrow R \circ L$ «стягивает» два объекта $a,\,b: \mathcal{D}$ в один $RLd=RLd': \mathcal{D}$. Из образа функтора $R$ не получится перейти к исходным объектам. И всё же, объекты образа будут «наиболее общими» в таком же смысле, что и, например, произведение типов среди всех кандидатов. 

![[! Диаграммы для 6 части#Восстановление забытого RL]]

### !!! про своеобразность обратности правого сопряжения


Часто выделяют особый класс *забывающих функторов*, объединённых одной идеей. Пусть левая категория $\mathcal{C}$ состоит из тех же объектов, что и $\mathcal{D}$, но морфизмов в ней меньше — hom-объекты в $\mathcal{C}$ ограничены дополнительными условиями. Типичный пример: справа у нас категория множеств $\mathrm{Set}$ со всеми возможными функциями, а слева — категория моноидов над множествами $\mathrm{Mon}(\mathrm{Set})$. Объекты $m$ в ней являются такой конструкцией $(a \in \mathrm{Set},\,mon:\; a \otimes a + 1 \rightarrow a,\, \text{законы моноида})$. Допустимы лишь те морфизмы, что переводят одни моноиды в другие, то есть коммутируют с $mon$, сохраняя законы ассоциативности композиции и нейтрального элементы. Нас тут интересует функтор $U:\; \mathrm{Mon(Set)} \rightarrow \mathrm{Set}$, сопоставляющий каждому моноиду его множество.

![[! Диаграммы для 6 части#Забывание моноида]]
В категории $\mathrm{Set}$ между любыми объектами полно морфизмов, которых нет в $\mathrm{Mon(Set)}$. Функтор $U$ **забывает ограничения** $\mathrm{Mon(Set)}$ — «особенные» морфизмы сохраняющие моноиды буквально теряются в $\mathrm{Set}$ среди прочих морфизмов. Функторы, отображающие hom-множества *не сюръективно*, называют «забывающим».

За восстановление потерянных данных отвечает функтор $F$, сопряжённый к $U$ слева: $F \vdash U$.
![[! Диаграммы для 6 части#Изоморфизм hom-объектов для сопряжения $F \vdash U$]]
Для любого множества $a$ функтор $F$ подбирает такой моноид $Fa$, чтобы каждому морфизму моноидов $Fa \rightarrow m$ взаимно однозначно соответствовал морфизм множеств $a \rightarrow Um$. Очевидно, что $UFa \neq a$, то есть функтор $F$ приводит к моноиду, у которого *основное множество* будет отличаться от исходного. Объект $Fa$ представляет собой *наиболее общий моноид* для множества $a$, такой, что для него существует столько же способов получить произвольный моноид $m$, сколько и обычных функций от $a$ к множеству $m$. Бинарная операция для $Fa$ должна быть максимально обобщённой, *свободной* от привязки к другим бинарным операциям и позволяющей получить любую из них. Такой объект называется *свободным моноидом* для множества $a$. Функторы, сопряженные к забывающим слева, называют **свободными функторами**.

![[Вспомнить всё.png|Примерно так свободный функтор пытается восстановить всё то, что растерял забывающий.|600]]

Наверняка вы уже знаете, что свободным моноидом над множеством является *список* его элементов. Проверить это не сложно, но гораздо важнее научится *конструктивно выводить* подобные знания из условий задачи. Это мы сделаем позже, когда у нас будет алгоритм вычисления сопряжений. Сейчас же давайте сконцентрируемся на «обратности» сопряженных функторов по отношению к исходному.



# Правые расширения Кана

Пусть у нас есть функтор $F$, и нам нужно найти для него такой $G_F$, чтобы существовало сопряжение $G_F \dashv F$ с естественными преобразованиями
$$
\begin{eqnarray}
\eta:\; Id \rightsquigarrow F \circ G_F\\
\varepsilon:\; G_F \circ F \rightsquigarrow Id
\end{eqnarray}
$$

Функтор $G_F$ выглядит обратным к $F$ в том смысле, что их композиция позволяет получить тождественный функтор $Id$, играющий роль «единицы» для операции композиции, напоминающей «произведение» функторов. Поэтому для $G_F$ встречается другое обозначение: $Id/F$, что делает сопряжение чуть более наглядным:
$$
\begin{eqnarray}
&\varepsilon:\; Id/F \circ F \rightsquigarrow Id\\
&\eta:\; Id \rightsquigarrow F \circ Id/F\\
\\
&Id/F \dashv F
\end{eqnarray}
$$

Конечно же, имеется виду не привычное деление, которое могло бы получиться, если бы здесь были строгие равенства и операция $\circ$ коммутировала. Сейчас это просто обозначение, в котором искомый функтор сформулирован через два известных, участвующих в естественных преобразованиях сопряжения. Но оно толсто намекает на *обобщение*, получаемое, если в коединице сопряжения заменить тождественный функтор на произвольный $K$, определённый на той же категории, что и $F$:


![[! Диаграммы для 6 части#Правое расширение Кана]]

> **Правым расширением Кана** функтора $K:\mathcal{C}\rightarrow\mathcal{D}$ вдоль функтора $F:\;\mathcal{C}\rightarrow\mathcal{A}$ называется такой функтор $\mathrm{Ran}_FK \equiv K/F:\; \mathcal{A}\rightarrow\mathcal{D}$ вместе с естественным преобразованием $\varepsilon: K/F \circ F \rightsquigarrow K$, что для любого кандидата $G:\mathcal{A} \rightarrow \mathcal{D}$ с преобразованием $\alpha: G \circ F \rightsquigarrow K$ существует единственное преобразование $u_\alpha: G \rightsquigarrow K/F$, такое что $\alpha=\varepsilon \cdot (u_\alpha \circ Id_{K})$.
> Обозначение $\mathrm{Ran}$ происходит от «**R**ight K**an** Extension», а преобразование $\varepsilon$ называют *коединицей* правого расширения Кана.
> Вертикальная $\cdot$ и горизонтальная $\circ$ композиции естественных преобразований были [представлены в обзоре ранее](https://habr.com/ru/articles/951574/).

Как же можно «расширить» один функтор «вдоль» другого? У математиков вообще очень своеобразное воображение. Но давайте всё же попробуем их понять ~~и простить~~.

Перерисуем предыдущую категориальную диаграмму в таком виде:
### !!! Поправить шрифты
![[Pasted image 20251214230949.png|800]]
Функторы $K$ и $F$ отображают категорию $\mathcal{C}$ в $\mathcal{A}$ и $\mathcal{D}$. Само это отображение уже как бы «сопоставляет» между собой образы функторов, подкатегории $K\mathcal{C}$ и $F\mathcal{C}$. Задача функтора $K/F$ — продемонстрировать это сопоставление, «расширив» его с образа $F\mathcal{C}$ на всю категорию $\mathcal{A}$ так, чтобы естественное преобразование $\varepsilon$ явно переводило объекты образа композиции $K/F\,\circ\,F$ в образ $K$. Получается, что подкатегория $K\mathcal{C}$ как бы «расширяется» до $(K/F)\mathcal{A}$, внутри которой есть подкатегория $(K/F\,\circ\,F)\mathcal{C}$, явно сопоставленная с $K\mathcal{C}$ преобразованием $\varepsilon$… Ну всё же очевидно, да? Впрочем, неважно — главное, что математики делают вид, что такое название вполне соответствует сути.


# Свойства правого расширения Кана

Запись правого расширения Кана через инфиксный оператор $F/G$ отражает своего рода «обратность» этой конструкции по отношению к композиции функторов, аналогично делению по отношению к умножению. В частности, для *композиции* расширений Кана $Ran_H \circ Ran_G$ справедлива привычная алгебраическая формула:
$$
(F/G)/H \cong F/(H \circ G).
$$

Обозначение $\mathrm{Ran}_GF$ является более стандартным. В этом случае $\mathrm{Ran}_G$ сам выступает в роли функтора, действующему между категориями функторов. Если $G:\mathcal{C}\rightarrow\mathcal{A}$, то для любой категории $\mathcal{D}$ получаем $\mathrm{Ran}_G:\mathcal{D}^\mathcal{C}\rightarrow\mathcal{D}^\mathcal{A}$. Любопытно, что этот функтор оказывается сопряжённым справа к *функтору предкомпозиции* функторов $\_ \circ G: \mathcal{D}^\mathcal{C}\rightarrow\mathcal{D}^\mathcal{A}$ (вместо подчёркивания подставляется функтор, композиция которого с $G$ даёт новый функтор):
$$
\_ \circ G \dashv \mathrm{Ran}_G.
$$

Действительно, для любого $H:\mathcal{A}\rightarrow\mathcal{D}$ справедлив следующий изоморфизм:
$$
\mathrm{Hom}_{\mathcal{D}^\mathcal{C}}(H \circ G,\, F) \cong \mathrm{Hom}_{\mathcal{D}^\mathcal{A}}(H,\, \mathrm{Ran}_G F).
$$
Слева здесь морфизмы в категории функторов $\mathcal{D}^\mathcal{C}$ — совокупность естественных преобразований $\alpha: H \circ G \rightsquigarrow F$, каждое из которых вместе с функтором $H$ образует *кандидата* в правое расширение Кана. Слева же — универсальный морфизм $u: H \rightsquigarrow \mathrm{Kan}_GF$ для этого кандидата. Изоморфизм просто говорит о том, что каждому кандидату взаимно однозначно соответствует единственный универсальный морфизм. Коединица такого сопряжения $\varepsilon_F: (F / G) \circ G \rightsquigarrow F$ соответствует коединице расширения Кана, а единица имеет вид $\eta_F:  F \rightsquigarrow (F \circ G) / G$.

Ранее в [предыдущей части обзора](https://habr.com/ru/articles/970762/#scala) мы разбирали сопряжение эндофункторов в категории типов `Writer[S] ⊣ Reader[S]`. Любопытно, что для него получается очень похожий hom-изоморфизм: $\mathrm{Hom}(A \times S, B) \cong \mathrm{Hom}(A, B^S)$. Произведение объектов аналогично (с некоторой натяжкой) композиции функторов, но если первой операции противопоставляется экспоненциал, то во втором случае мы получили что-то вроде деления! Неужели эти понятия как-то связаны, или же так получилось случайно? На самом деле, случайности не случайны, и чуть позже мы убедимся в этом.

Перечисленные здесь свойства характерны не только для правых расширений Кана, они без труда переносится и на

# Левые расширения Кана

Мы пришли к правому расширению Кана, обобщив задачу поиска левого сопряжения (как ни парадоксально)). Если же мы бы начали с поиска правого расширения, то, ожидаемо, получили бы левое расширение Кана:

>**Левым расширением Кана** функтора $K:\mathcal{C}\rightarrow\mathcal{D}$ вдоль функтора $F:\;\mathcal{C}\rightarrow\mathcal{A}$ называется такой функтор $\mathrm{Lan}_FK:\; \mathcal{A}\rightarrow\mathcal{D}$ вместе с естественным преобразованием $\eta: K \rightsquigarrow \mathrm{Lan}_FK \circ F$, что для любого кандидата $G:\mathcal{A} \rightarrow \mathcal{D}$ с преобразованием $\alpha: K \rightsquigarrow G \circ F$ существует единственное преобразование $u_\alpha: \mathrm{Lan}_FK \rightsquigarrow G$, такое что $\alpha= (u_\alpha \circ Id_{K}) \cdot \eta$.
>Обозначение $\mathrm{Lan}$ происходит от «**L**eft K**an** Extension», а преобразование $\eta$ называют *единицей* левого расширения Кана.

![[! Диаграммы для 6 части#Левое расширение Кана]]

В данном обзоре наравне с общепринятым будет использоваться нестандартное обозначение $F \backslash K \equiv \mathrm{Lan}_FK$. Функтор, который мы факторизуем располагается как бы над чертой, а через который факторизуем — под ней. Такое обозначение «левого деления функторов» отражает дуализм по отношению к «правому делению» $K/F$.

По аналогии с $\mathrm{Ran}_G$, универсальное свойство для $\mathrm{Lan}_G$ образует похожее сопряжение с функтором предкомпозиции, что даёт такую [сопряжённую тройку](https://habr.com/ru/articles/970762/#triple):
$$
\mathsf{Lan}_G \dashv (\_ \circ G) \dashv \mathsf{Ran}_G.
$$
Для левых расширений Кана работает похожее правило композиции: $Lan_H (Lan_G F) \cong Lan_{H \circ G} F$, или в других обозначениях
$$
H\backslash(G\backslash F) = (H \circ G)\backslash F.
$$

### !!! Спойлер Подъёмы Кана

>Расширения Кана строятся для функторов, *исходящих* из одной категории. Но можно пойти и другим путём — рассматривать функторы, *сходящиеся* в одну и ту же категорию. Тогда получатся ещё два способа факторизации одного функтора по другому. Эти конструкции называются *подъёмами Кана* $\mathrm{Lift}$ и $\mathrm{Rift}$. В отличие от расширений Кана, они образуют сопряжённую тройку вокруг *посткомпозиции*:
$$
\mathrm{Lift}_G \dashv (G \circ \_) \dashv \mathrm{Rift}_G.
$$
Подъёмы Кана обладают свойствами, аналогичными расширениям, и они имеют те же основания называться «делением функторов». Так что в сумме мы имеем целых четыре различные операции, «обратные» композиции функторов. И это одна из причин, почему инфиксный оператор $/$ не часто используется в качестве обозначения правого расширения Кана.
Тем не мнее, расширений Кана вполне достаточно для решения большинства задач и подъёмы Кана практически нигде не рассматриваются.



Давайте посмотрим на конкретные примеры как левых, так и правых расширений Кана.





# Примеры расширений Кана

Для начала давайте вспомним, как устроены (ко)пределы функторов. Для некоторого (не для каждого) функтора $F:\mathcal{C} \rightarrow \mathcal{D}$ существуют такие объекты $\mathrm{(Co)Lim}_F: \mathcal{D}$, которые в некотором смысле наилучшим образом представляют этот самый функтор. Такой объект, вместе с семейством морфизмов, индексированных объектами $c:\mathcal{C}$ образуют универсальный [(ко)конус](https://habr.com/ru/articles/970762/#cones) — естественное преобразование между заданным функтором $F$ и константным $\Delta_{\mathrm{(Co)Lim}\,F}$.

Константный функтор $\Delta_d: \mathcal{C} \rightarrow \mathcal{D}$ сочетает в себе две операции — полное «забывание» всей структуры категории $\mathcal{C}$ и *выбор* конкретного объекта $d: \mathcal{D}$. Удобно факторизовать диагональный функтор на два вспомогательных — один будет отвечать за «схлопывание» исходной категории в категорию $1$, состоящую из единственного объекта и его тождественного морфизма, а другой функтор будет отображать $1$ в $\mathcal{D}$, выбирая там нужный объект $d$:
$$
\begin{eqnarray}
\Delta_d &:& \mathcal{C} \rightarrow \mathcal{D} = d\, \circ\, !,\; \text{где}\\
!&:& \mathcal{C} \rightarrow 1,\\
d&:& 1 \rightarrow \mathcal{D}.
\end{eqnarray}
$$

Категория $1$ является *терминальным объектом* в категории категорий — функтор $!$ является его универсальным морфизмом, *единственным образом* «забывающим» структуру исходной категории, переводя все её морфизмы в тождественный для единственного объекта. Эта ситуация аналогична той, что мы рассматривали раньше в категории типов — тип `Unit` является её терминальным объектом, так существует единственный способ (функция) привести к нему любой другой тип.

Любой функтор, исходящий из $1$ моделирует её в конечной категории $D$, то есть, по сути, выбирает из неё единственный объект. Категория таких функторов $D^1$ изоморфна дискретной подкатегории, построенной на тех же объектах что и $D$. Поэтому часто для простоты эти функторы обозначают также, как и объекты $d: 1 \rightarrow \mathcal{D}$.

Получается следующая диаграмма в категории категорий:
![[! Диаграммы для 6 части#(Ко)предел]]

Функтор $F$ факторизуется через $!$ посредством «наилучших» $\mathrm{Colim}_F$ и $\mathrm{Lim}_F$, что отсылает нас к расширениям Кана. Действительно, несложно убедиться, что
$$
\begin{eqnarray}
\mathrm{Lim}_F &\cong& F / !,\\
\mathrm{Colim}_F &\cong& ! \backslash F.
\end{eqnarray}
$$
Другими словами, если (ко)предел функтора $F$ существует, то соответствующий «выбирающий функтор» будет изоморфен (левому)правому расширению Кана $F$ вдоль $!$.

Ранее уже были намёки, но теперь скажем открыто: левое и правое сопряжения функтора $F:\, \mathcal{C}\rightarrow\mathcal{D}$ являются правым и левым расширениями Кана тождественного функтора $Id:\mathcal{C}\rightarrow\mathcal{C}$ вдоль $F$:
$$
\begin{eqnarray}
{Id} / F \dashv F \dashv F \backslash {Id}.
\end{eqnarray}
$$
В [предыдущей части обзора](https://habr.com/ru/articles/970762/#triple) было показано, как сопряжённые тройки порождают монады и комонады. Представленная тройка интересна тем, что она параметризирована единственным функтором $F$ — он один порождает целую россыпь (ко)монад! Например, самые простые монады, что можно получить из данной тройки, будут для эндофункторов $F \circ (Id/F):\;\mathcal{D}\rightarrow\mathcal{D}$ и $(F \backslash Id) \circ F:\;\mathcal{C}\rightarrow\mathcal{C}$. Но это далеко не всё, что расширения Кана позволяют вытянуть из единственного функтора.

Конечно же, не для каждого функтора могут существовать левое и правое сопряжение, тогда как расширения Кана можно построить всегда. В таких случаях их можно рассматривать как «наилучшие попытки» построить сопряжения, например, в том смысле, что их композиции с исходным функтором могут порождать (ко)монады.

Ес



### !! Плотность/коплотность
$$
\begin{eqnarray}
\mathrm{Dens}_F=F \backslash F\\
\mathrm{Codens}_F=F/F\\
\end{eqnarray}
$$
Поскольку каждая монада может быть получена из сопряжения, то отсюда следует, что каждая монада является ко-плотной монадой для этого сопряжения.
 
### !! Предел/копредел
$$
\begin{eqnarray}
\mathrm{Lim}=\mathrm{Ran}_!\\
\mathrm{Colim}=\mathrm{Lan}_!\\
\end{eqnarray}
$$


### !! Йонеда
$$
\begin{eqnarray}
よ=\mathrm{Ran}_{Id}\\
よ^{op}=\mathrm{Lan}_{Id}\\
\end{eqnarray}
$$
Ключ к понимаю, как найти «обратные» функторы?
 https://webhomes.maths.ed.ac.uk/~tl/categories/yoneda.pdf
 
 ![[米田]]
 Теорема Йонеды устанавливает связь между объектами категории и предпучками на этой категории.  Для любой локально малой категории C и любого объекта X в C, функтор Йонеды Hom(-, X) : C^op -> Set отображает X в предпучок, который кодирует все морфизмы в X.  Теорема Йонеды говорит, что для любого предпучка P : C^op -> Set, множество естественных преобразований Nat(Hom(-, X), P) (между предпучком Йонеды, связанным с X, и предпучком P) естественно изоморфно множеству P(X).  То есть:

    Nat(Hom(-, X), P) ≅ P(X)





# !!! Категория запятой

- Точечные Кана расширения (Pointwise Kan extensions):  В некоторых случаях, Кана расширения можно вычислять "поточечно", что значительно упрощает их анализ. Теория предпучков играет важную роль в определении условий, при которых Кана расширения являются точечными.



https://en.wikipedia.org/wiki/Comma_category
$$
\begin{eqnarray}
F&:& \mathcal{C} \rightarrow \mathcal{D}\\
G&:& \mathcal{E} \rightarrow \mathcal{D}\\
F \downarrow G&:& \{ f: Fc \rightarrow Ge \}\\
F/d = F \downarrow d &:& \{ f: Fc \rightarrow d \} \;\;\;\;\; \text{здесь $d$ - это функтор из $1$ в $D$, выбирающий $d$}
\end{eqnarray}
$$


$$
\begin{eqnarray}
\mathrm{Cone}_F:\; \mathcal{C}^{op} \rightarrow \mathrm{Hom}_{\mathcal{C}^{\mathcal{I}}}(\Delta\, \_,\, F)\\
\mathrm{Hom}_{\mathcal{C}^{\mathcal{I}}}(\Delta\, \_,\, F) =
\Delta \mathcal{C} / F =
\Delta \downarrow F\\
U_{\mathrm{Lim}F}:\; \mathcal{C}^{op} \rightarrow {\rm Hom}_{\mathcal{C}}(\_,\, {\rm Lim}\, F)\\
{\rm Hom}_{\mathcal{C}}(\_,\, {\rm Lim}\, F) =
\mathcal{C} / {{\rm Lim}\, F} =
Id \downarrow ({\rm Lim}\, F)\\
\end{eqnarray}
$$
F ↓ Id ≅ Id ↓ G является абсолютно корректным следствием существования сопряженных функторов F ⊣ G
$$
F \dashv G
\hspace{1cm} \Longrightarrow \hspace{1cm}
F \downarrow Id \cong Id \downarrow G
$$

## !!! Категория конусов


## !!! расширение Кана как предел



# !! Исчисление концов

![[Слово Конец.png|1000]]



http://comonad.com/reader/2008/kan-extension-iii/

## !! Диестественные преобразования



# Дополнительная литература


- [String Diagrams](https://stringdiagram.com/) (Dan Marsden)
	- [Codensity Monads and Kan Extensions](https://stringdiagram.com/2022/12/06/codensity-monads-and-kan-extensions/)
	- [Where do monads come from?](https://stringdiagram.com/2022/05/17/where-do-monads-come-from/)
	- [The Codensity Monad Transformer](https://stringdiagram.com/2023/05/14/the-codensity-monad-transformer/)
	- [The Continuation Monad](https://stringdiagram.com/2022/11/21/the-continuation-monad/)
- [Bartosz Milewski's Programming Cafe](https://bartoszmilewski.com/ "Bartosz Milewski's Programming Cafe")
	- [Kan extensions](https://bartoszmilewski.com/2017/04/17/kan-extensions/)
	- [Pointwise Kan extensions](https://bartoszmilewski.com/2018/01/23/pointwise-kan-extensions/)
	- [Monads categorically](https://bartoszmilewski.com/2016/12/27/monads-categorically/)
	- [Algebras for monads](https://bartoszmilewski.com/2017/03/14/algebras-for-monads/)
- [Comonads](http://comonad.com/reader/) (Ed Kmett)
	- [Kan Extensions](http://comonad.com/reader/2008/kan-extensions/ "Permanent Link: Kan Extensions")
	- [Kan Extensions II: Adjunctions, Composition, Lifting](http://comonad.com/reader/2008/kan-extensions-ii/ "Permanent Link: Kan Extensions II: Adjunctions, Composition, Lifting")
- [Higher Order](https://blog.higher-order.com/) (Rúnar Óli Bjarnason)
	- [Freedom and Forgetfulness](https://blog.higher-order.com/blog/2015/10/12/freedom-and-forgetfulness/)
	- [Free Monoids and Free Monads](https://blog.higher-order.com/blog/2013/08/20/free-monads-and-free-monoids/)

![[Расширения Кана]]


# Промежуточный итог


Изоморфизм $G\circ \>\mathrm{Ran}\>{}_{F}\text{Id}\cong \>\mathrm{Ran}\>{}_{F}G$ гарантированно выполняется в следующих случаях:
- $G$ — правый сопряженный: Если у функтора $G$ есть левый сопряженный $L \dashv G$, то он сохраняет все пределы, и, следовательно, сохраняет правые расширения Кана.
- Наличие левого сопряжения у $F$: Если у функтора $F$ есть левый сопряженный $L \dashv F$, то, как мы разбирали ранее, $\mathrm{Ran}\>{}_{F}X\cong X\circ L$. В этом случае изоморфизм становится тривиальным свойством ассоциативности композиции функторов: $G\circ (\text{Id}\circ L)\cong (G\circ \text{Id})\circ L\cong G\circ L$
- $\mathrm{Ran}_{F}\text{Id}$ — *абсолютное расширение Кана*: Это расширение, которое сохраняется вообще любым функтором $G$. Это редкий случай, встречающийся, например, если $F$ — вполне верный функтор с сопряжением (или изоморфизм категорий).

http://comonad.com/reader/2015/categories-of-structures-in-haskell/

http://comonad.com/reader/2008/kan-extensions-ii/#:~:text=Changing%20Representation

Given a `f -| g`, ``g `O` f`` is a monad, and ``Ran (g `O` f) (g `O` f)`` is the monad generated by ``(g `O` f)``, described in the previous post. We showed above that this monad can do many of the same things that the original monad could do. From there you can `decomposeRan` to get ``Ran g (Ran f (g `O` f))``, which you can show to be yet another monad, and you can continue on from there.

Each of these monads may have different operational characteristics and performance tradeoffs. For instance the codensity monad of a monad can offer [better asymptotic performance](http://wwwtcs.inf.tu-dresden.de/~voigt/mpc08.pdf) in some usage scenarios.

Similarly the left Kan extension can be used to manipulate the representation of a comonad.




This monad provides a useful opportunity for optimization. For instance Janis Voigtländer noted in [Asymptotic improvement of functions over Free Monads](http://wwwtcs.inf.tu-dresden.de/~voigt/mpc08.pdf) that a particular monad could be used to improve performance -- Free monads as you'll recall are the tool used in Wouter Sweirstra's [Data Types á la Carte](http://www.cs.nott.ac.uk/~wss/Publications/DataTypesALaCarte.pdf), and provide an approach for, among other things, decomposing the `IO` monad into something more modular, so this is by no means a purely academic exercise!


### !!! выяснить!!
> Наиболее важное свойство сопряжённых функторов — их непрерывность: каждый функтор, имеющий левый сопряжённый (то есть являющийся правым сопряжённым), коммутирует с [пределами](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B5%D0%B4%D0%B5%D0%BB_\(%D1%82%D0%B5%D0%BE%D1%80%D0%B8%D1%8F_%D0%BA%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D0%B9\) "Предел (теория категорий)") в категорном смысле. Соответственно, функтор, имеющий правый сопряжённый, _конепрерывен_, то есть коммутирует с [копределами](https://ru.wikipedia.org/w/index.php?title=%D0%9A%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB_\(%D1%82%D0%B5%D0%BE%D1%80%D0%B8%D1%8F_%D0%BA%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D0%B9\)&action=edit&redlink=1 "Копредел (теория категорий) (страница отсутствует)").
